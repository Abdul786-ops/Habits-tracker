<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>üöÄ Elite Life Mastery System By: Kevin Lisboa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header .tagline {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
            margin-bottom: 15px;
        }

        .timezone-info {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-size: 14px;
            font-weight: 500;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            box-shadow: 0 5px 20px rgba(255,107,107,0.4);
            border-color: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            background: rgba(255,255,255,0.96);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Alerts */
        .missed-alert {
            background: linear-gradient(135deg, #ff7675, #e17055);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(255,118,117,0.3);
            animation: slideDown 0.5s ease;
        }

        .missed-alert h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .missed-alert ul {
            margin: 15px 0;
            padding-left: 20px;
        }

        .alert-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .alert-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .alert-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .streak-banner {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 5px 20px rgba(0,184,148,0.3);
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Energy */
        .energy {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(255,107,107,0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 8px 25px rgba(255,107,107,0.3); }
            50% { box-shadow: 0 12px 35px rgba(255,107,107,0.5); }
            100% { box-shadow: 0 8px 25px rgba(255,107,107,0.3); }
        }

        /* Daily Tracker */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .habit-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 18px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }

        .habit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .habit-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .habit-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .habit-icon {
            font-size: 2.5em;
            margin-right: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .habit-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #2c3e50;
            line-height: 1.2;
        }

        .practices-list {
            margin-bottom: 20px;
        }

        .practice-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .practice-item:hover {
            background: rgba(255,255,255,1);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .practice-checkbox {
            margin-right: 12px;
            transform: scale(1.3);
            cursor: pointer;
        }

        .practice-text {
            flex-grow: 1;
            font-size: 14px;
            line-height: 1.4;
            color: #555;
        }

        .habit-score {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            border: 2px solid rgba(0,0,0,0.05);
        }

        .score-value {
            font-size: 2.2em;
            font-weight: 800;
            color: #27ae60;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .score-label {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Journal Section */
        .journal-container {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 18px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(252,182,159,0.3);
            margin-bottom: 30px;
        }

        .journal-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .journal-tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.7);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #e67e22;
        }

        .journal-tab:hover {
            background: rgba(255,255,255,0.9);
            transform: translateY(-1px);
        }

        .journal-tab.active {
            background: #e67e22;
            color: white;
            box-shadow: 0 4px 15px rgba(230,126,34,0.3);
        }

        .journal-content {
            display: none;
        }

        .journal-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .journal-prompt {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #e67e22;
        }

        .journal-prompt-text {
            font-style: italic;
            color: #e67e22;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .journal-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid rgba(230,126,34,0.2);
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
            background: rgba(255,255,255,0.95);
        }

        .journal-textarea:focus {
            outline: none;
            border-color: #e67e22;
            box-shadow: 0 4px 15px rgba(230,126,34,0.2);
        }

        .journal-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .word-count {
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 12px;
        }

        .tag-input {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 11px;
            background: rgba(255,255,255,0.9);
        }

        /* Enhanced Reflection Section */
        .reflection-area {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(195,230,203,0.4);
        }

        .reflection-title {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
            text-align: center;
        }

        .coaching-prompts {
            display: grid;
            gap: 25px;
            margin-bottom: 25px;
        }

        .prompt-card {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #27ae60;
        }

        .prompt-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .prompt-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .prompt-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
        }

        .prompt-text {
            font-style: italic;
            color: #27ae60;
            margin-bottom: 15px;
            line-height: 1.6;
            font-weight: 500;
        }

        .reflection-input {
            width: 100%;
            min-height: 80px;
            padding: 15px;
            border: 2px solid rgba(39,174,96,0.2);
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .reflection-input:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 4px 15px rgba(39,174,96,0.2);
        }

        /* Performance Planning Section */
        .performance-planning {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(187,222,251,0.4);
        }

        .planning-title {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
            text-align: center;
        }

        .planning-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .planning-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #2196f3;
        }

        .planning-card h4 {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.1em;
            font-weight: 700;
        }

        .planning-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(33,150,243,0.2);
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
            transition: border-color 0.3s ease;
        }

        .planning-input:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 3px 10px rgba(33,150,243,0.2);
        }

        .planning-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid rgba(33,150,243,0.2);
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .planning-textarea:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 4px 15px rgba(33,150,243,0.2);
        }

        .energy-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        /* Weekly/Monthly/Yearly Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            text-align: center;
            padding: 25px 20px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(116,185,255,0.3);
            transition: transform 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
        }

        .overview-score {
            font-size: 2.8em;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .overview-label {
            font-size: 13px;
            opacity: 0.95;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Weekly History */
        .week-history {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 16px;
            margin-top: 30px;
        }

        .history-title {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: 600;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .day-box {
            padding: 15px 10px;
            text-align: center;
            background: white;
            border-radius: 10px;
            font-size: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .day-box.score-high {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            box-shadow: 0 4px 15px rgba(0,184,148,0.3);
        }

        .day-box.score-medium {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            box-shadow: 0 4px 15px rgba(253,203,110,0.3);
        }

        .day-box.score-low {
            background: linear-gradient(135deg, #ff7675, #e17055);
            color: white;
            box-shadow: 0 4px 15px rgba(255,118,117,0.3);
        }

        /* Monthly/Yearly Navigation */
        .period-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .nav-arrow {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-arrow:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .period-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        /* Calendar */
        .calendar-section {
            margin: 30px 0;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 16px;
        }

        .section-title {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.4em;
            font-weight: 600;
        }

        .calendar-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
            font-weight: 600;
            color: #666;
            text-align: center;
            font-size: 14px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: #f8f9fa;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102,126,234,0.4);
        }

        .calendar-day.no-data {
            background: #f1f3f4;
            color: #999;
        }

        .calendar-day.low-score {
            background: linear-gradient(135deg, #ff7675, #e17055);
            color: white;
        }

        .calendar-day.mid-score {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
        }

        .calendar-day.high-score {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-dot.no-data { background: #f1f3f4; }
        .legend-dot.low-score { background: linear-gradient(135deg, #ff7675, #e17055); }
        .legend-dot.mid-score { background: linear-gradient(135deg, #fdcb6e, #e17055); }
        .legend-dot.high-score { background: linear-gradient(135deg, #00b894, #00a085); }

        /* Trends */
        .trends-section {
            margin: 30px 0;
        }

        .trend-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .trend-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .trend-info h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .trend-details {
            font-size: 14px;
            color: #666;
        }

        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .trend-up {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
        }

        .trend-down {
            background: linear-gradient(45deg, #ff7675, #e17055);
            color: white;
        }

        .trend-stable {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
        }

        /* Yearly Chart */
        .chart-section {
            margin: 30px 0;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 16px;
        }

        .year-chart {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .chart-bars {
            display: flex;
            align-items: end;
            gap: 8px;
            height: 200px;
            margin: 20px 0;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 6px 6px 0 0;
            min-height: 20px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover {
            transform: scaleY(1.05);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #666;
            font-weight: 600;
        }

        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 700;
            color: #2c3e50;
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Seasonal Analysis */
        .seasonal-analysis {
            margin: 30px 0;
        }

        .seasons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .season-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .season-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .season-card.best-season {
            border-color: #00b894;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .season-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .season-score {
            font-size: 2.2em;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 5px;
        }

        .season-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Insights */
        .insights-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .insight-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid rgba(0,0,0,0.02);
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
        }

        .insight-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .insight-value {
            font-size: 2.5em;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .insight-label {
            font-size: 13px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Yearly Insights */
        .yearly-insights {
            margin: 30px 0;
        }

        .yearly-insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .yearly-insight-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border-left: 6px solid #667eea;
        }

        .insight-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .insight-emoji {
            font-size: 2em;
            margin-right: 15px;
        }

        .insight-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #2c3e50;
        }

        .insight-content {
            color: #555;
            line-height: 1.6;
        }

        .insight-stat {
            font-size: 1.8em;
            font-weight: 800;
            color: #667eea;
            margin: 10px 0;
        }

        /* Habits Management */
        .habits-management {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .habit-section {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 25px;
            border-left: 6px solid #3498db;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title-habits {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
        }

        .add-btn {
            background: linear-gradient(45deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,184,148,0.4);
        }

        .practices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .practice-row {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .practice-row:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .practice-content {
            flex-grow: 1;
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* Wisdom Section */
        .wisdom-section {
            margin-top: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 16px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 25px rgba(240,147,251,0.3);
        }

        .wisdom-title {
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .wisdom-quote {
            font-style: italic;
            line-height: 1.7;
            font-size: 15px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        /* Journal History Modal */
        .journal-history-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
        }

        .journal-history-content {
            background: white;
            margin: 5% auto;
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s ease;
        }

        .journal-entry {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #e67e22;
        }

        .journal-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .journal-entry-content {
            margin-bottom: 10px;
            white-space: pre-wrap;
        }

        .journal-entry-tags {
            font-size: 12px;
            color: #666;
        }

        .journal-entry-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-journal-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .edit-journal-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102,126,234,0.2);
        }

        .form-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* Utilities */
        .data-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .save-indicator {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(46, 204, 113, 0.95);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 20px rgba(46,204,113,0.4);
            transition: all 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .habits-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
            
            .nav-tab {
                width: 90%;
                max-width: 300px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .timezone-info {
                flex-direction: column;
                gap: 8px;
            }

            .period-navigation {
                flex-direction: column;
                gap: 15px;
            }

            .calendar-grid {
                gap: 3px;
            }

            .chart-bars {
                height: 150px;
            }

            .energy-inputs {
                grid-template-columns: 1fr;
            }
            
            .journal-history-content {
                padding: 20px;
            }
            
            .journal-entry-header {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ Elite Life Mastery System By: Kevin Lisboa</h1>
    <p class="tagline">"HIGH PERFORMANCE isn't luck. It's a LEARNABLE set of habits!" - Kevin Lisboa</p>
            <div class="timezone-info">
                <span id="currentTime">üïê Loading...</span>
                <span id="currentDate">üìÖ Loading...</span>
                <span id="currentZone">üåç Loading...</span>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('daily')">Daily Tracker</button>
            <button class="nav-tab" onclick="showSection('weekly')">Weekly Review</button>
            <button class="nav-tab" onclick="showSection('monthly')">Monthly Trends</button>
            <button class="nav-tab" onclick="showSection('yearly')">Yearly Analytics</button>
            <button class="nav-tab" onclick="showSection('habits')">Manage Habits</button>
            <button class="nav-tab" onclick="showSection('insights')">Insights</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Daily Tracker Section -->
            <div id="daily" class="content-section active">
                <div id="alertsContainer"></div>
                
                <div class="energy">
                    "Champions don't just check boxes - they MASTER the complete process of growth!" <br>
                    <strong>Today's Mission: Complete your habits, journal your thoughts, reflect deeply, and design tomorrow!</strong>
                </div>
                
                <h2 class="page-title">üî• Today's High Performance Check-In üî•</h2>
                <div class="habits-grid" id="habitsGrid"></div>

                <!-- Journal Section -->
                <div class="journal-container">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50; font-size: 1.5em; font-weight: 700;">üìù Free-Form Journal</h3>
                    <p style="text-align: center; margin-bottom: 20px; color: #e67e22; font-style: italic;">Brain dump, process, and explore your thoughts without limits!</p>
                    
                    <div class="journal-tabs">
                        <button class="journal-tab active" onclick="showJournalTab('morning')">üåÖ Morning Pages</button>
                        <button class="journal-tab" onclick="showJournalTab('gratitude')">üôè Gratitude</button>
                        <button class="journal-tab" onclick="showJournalTab('learning')">üìö Learning Log</button>
                        <button class="journal-tab" onclick="showJournalTab('breakthrough')">üí° Breakthroughs</button>
                        <button class="journal-tab" onclick="showJournalTab('free')">‚úçÔ∏è Free Write</button>
                    </div>

                    <div id="morning" class="journal-content active">
                        <div class="journal-prompt">
                            <div class="journal-prompt-text">
                                "Stream of consciousness writing - just let everything flow out of your head. No editing, no perfection, just PURE PROCESSING!"
                            </div>
                        </div>
                        <textarea class="journal-textarea" id="morningJournal" 
                                 placeholder="Start writing... let your thoughts flow freely. Don't stop, don't edit, just brain dump everything onto the page..."></textarea>
                        <div class="journal-stats">
                            <div class="word-count" id="morningWordCount">Words: 0 | Target: 300+</div>
                            <input type="text" class="tag-input" id="morningTags" placeholder="Add tags (e.g., energy, goals, fears)">
                        </div>
                    </div>

                    <div id="gratitude" class="journal-content">
                        <div class="journal-prompt">
                            <div class="journal-prompt-text">
                                "Gratitude isn't just nice - it's a HIGH PERFORMANCE strategy! What are you genuinely appreciative of today?"
                            </div>
                        </div>
                        <textarea class="journal-textarea" id="gratitudeJournal" 
                                 placeholder="I'm grateful for...

1. 
2. 
3. 

Why these matter to me today..."></textarea>
                        <div class="journal-stats">
                            <div class="word-count" id="gratitudeWordCount">Words: 0</div>
                            <input type="text" class="tag-input" id="gratitudeTags" placeholder="Add tags (e.g., family, health, opportunity)">
                        </div>
                    </div>

                    <div id="learning" class="journal-content">
                        <div class="journal-prompt">
                            <div class="journal-prompt-text">
                                "High performers are LEARNING MACHINES! What did you discover, learn, or realize today?"
                            </div>
                        </div>
                        <textarea class="journal-textarea" id="learningJournal" 
                                 placeholder="Today I learned...

New insights about myself:

Key takeaways:

How I'll apply this:"></textarea>
                        <div class="journal-stats">
                            <div class="word-count" id="learningWordCount">Words: 0</div>
                            <input type="text" class="tag-input" id="learningTags" placeholder="Add tags (e.g., skills, insights, books)">
                        </div>
                    </div>

                    <div id="breakthrough" class="journal-content">
                        <div class="journal-prompt">
                            <div class="journal-prompt-text">
                                "AHA MOMENTS are gold! Capture those breakthrough insights, realizations, and game-changing thoughts!"
                            </div>
                        </div>
                        <textarea class="journal-textarea" id="breakthroughJournal" 
                                 placeholder="My breakthrough moment today was...

This changes everything because...

My next action based on this insight:"></textarea>
                        <div class="journal-stats">
                            <div class="word-count" id="breakthroughWordCount">Words: 0</div>
                            <input type="text" class="tag-input" id="breakthroughTags" placeholder="Add tags (e.g., career, relationships, mindset)">
                        </div>
                    </div>

                    <div id="free" class="journal-content">
                        <div class="journal-prompt">
                            <div class="journal-prompt-text">
                                "Sometimes you just need to WRITE! No structure, no rules - just pure expression and processing."
                            </div>
                        </div>
                        <textarea class="journal-textarea" id="freeJournal" 
                                 placeholder="Write whatever is on your mind, in your heart, or bouncing around your head..."></textarea>
                        <div class="journal-stats">
                            <div class="word-count" id="freeWordCount">Words: 0</div>
                            <input type="text" class="tag-input" id="freeTags" placeholder="Add tags for this entry">
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveJournal()">üíæ Save Journal Entry</button>
                        <button class="btn btn-secondary" onclick="showJournalHistory()">üìö View Journal History</button>
                    </div>
                </div>
                
                <!-- Enhanced Reflection Section -->
                <div class="reflection-area">
                    <h3 class="reflection-title">üéØ High Performance Reflection</h3>
                    <div class="coaching-prompts" id="coachingPrompts"></div>
                    <button class="btn btn-primary" onclick="saveReflection()" style="margin-top: 15px;">Save Reflection</button>
                </div>

                <!-- Performance Planning Section -->
                <div class="performance-planning">
                    <h3 class="planning-title">üöÄ Tomorrow's Performance Design</h3>
                    <div class="planning-grid">
                        <div class="planning-card">
                            <h4>üéØ Tomorrow's #1 Priority</h4>
                            <input class="planning-input" id="priorityInput" placeholder="What's the ONE thing that if accomplished tomorrow, would make it a high-performance day?">
                        </div>
                        
                        <div class="planning-card">
                            <h4>‚ö° Energy Design</h4>
                            <div class="energy-inputs">
                                <input class="planning-input" id="bedtimeInput" placeholder="What time will I go to bed tonight?">
                                <input class="planning-input" id="wakeupInput" placeholder="What time will I wake up tomorrow?">
                                <input class="planning-input" id="peakEnergyInput" placeholder="When is my peak energy window tomorrow?">
                                <input class="planning-input" id="peakActivityInput" placeholder="What will I do during my peak energy time?">
                            </div>
                        </div>
                        
                        <div class="planning-card">
                            <h4>üî• Tomorrow's Habit Intentions</h4>
                            <textarea class="planning-textarea" id="habitIntentionsInput" placeholder="For each habit I struggled with today, what SPECIFIC action will I take tomorrow?

Clarity: 
Energy: 
Necessity: 
Productivity: 
Influence: 
Courage:"></textarea>
                        </div>
                        
                        <div class="planning-card">
                            <h4>üõ°Ô∏è Obstacle Anticipation</h4>
                            <textarea class="planning-textarea" id="obstaclesInput" placeholder="What could derail my high performance tomorrow?

Obstacle 1: _______________
My plan if this happens: _______________

Obstacle 2: _______________  
My plan if this happens: _______________

Obstacle 3: _______________
My plan if this happens: _______________"></textarea>
                        </div>
                        
                        <div class="planning-card">
                            <h4>üëë Identity Statement</h4>
                            <textarea class="planning-textarea" id="identityInput" placeholder="Complete this sentence and read it when you wake up:

'Tomorrow I will show up as someone who...'

(Example: 'Tomorrow I will show up as someone who prioritizes their health, leads with courage, and creates value for others.')"></textarea>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveTomorrowPlan()">üîí Lock In Tomorrow's Plan</button>
                </div>
            </div>

            <!-- Weekly Review Section -->
            <div id="weekly" class="content-section">
                <h2 class="page-title">Weekly High Performance Review</h2>
                <div class="overview-grid" id="weeklyGrid"></div>
                
                <div class="week-history">
                    <h3 class="history-title">This Week's Progress</h3>
                    <div class="days-grid" id="daysGrid"></div>
                </div>
            </div>

            <!-- Monthly Trends Section -->
            <div id="monthly" class="content-section">
                <h2 class="page-title">Monthly Performance Trends</h2>
                
                <div class="period-navigation">
                    <button class="nav-arrow" onclick="changeMonth(-1)">‚Üê Previous</button>
                    <h3 id="currentMonth" class="period-title">June 2025</h3>
                    <button class="nav-arrow" onclick="changeMonth(1)">Next ‚Üí</button>
                </div>
                
                <div class="overview-grid" id="monthlyOverview"></div>
                
                <div class="calendar-section">
                    <h3 class="section-title">Monthly Heat Map</h3>
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                        </div>
                        <div class="calendar-grid" id="monthlyCalendar"></div>
                        <div class="calendar-legend">
                            <div class="legend-item"><div class="legend-dot no-data"></div><span>No Data</span></div>
                            <div class="legend-item"><div class="legend-dot low-score"></div><span>0-49%</span></div>
                            <div class="legend-item"><div class="legend-dot mid-score"></div><span>50-79%</span></div>
                            <div class="legend-item"><div class="legend-dot high-score"></div><span>80-100%</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="trends-section">
                    <h3 class="section-title">Month-over-Month Trends</h3>
                    <div id="monthlyTrends"></div>
                </div>
            </div>

            <!-- Yearly Analytics Section -->
            <div id="yearly" class="content-section">
                <h2 class="page-title">Yearly High Performance Analytics</h2>
                
                <div class="period-navigation">
                    <button class="nav-arrow" onclick="changeYear(-1)">‚Üê Previous</button>
                    <h3 id="currentYear" class="period-title">2025</h3>
                    <button class="nav-arrow" onclick="changeYear(1)">Next ‚Üí</button>
                </div>
                
                <div class="overview-grid" id="yearlyOverview"></div>
                
                <div class="chart-section">
                    <h3 class="section-title">Monthly Performance Throughout the Year</h3>
                    <div class="year-chart" id="yearlyChart"></div>
                </div>
                
                <div class="seasonal-analysis">
                    <h3 class="section-title">Seasonal Performance Analysis</h3>
                    <div class="seasons-grid" id="seasonalGrid"></div>
                </div>
                
                <div class="yearly-insights">
                    <h3 class="section-title">Yearly Growth Insights</h3>
                    <div id="yearlyInsightCards"></div>
                </div>
            </div>

            <!-- Manage Habits Section -->
            <div id="habits" class="content-section">
                <h2 class="page-title">Customize Your High Performance Practices</h2>
                <div class="habits-management" id="habitsManagement"></div>
            </div>

            <!-- Insights Section -->
            <div id="insights" class="content-section">
                <h2 class="page-title">High Performance Insights</h2>
                <div class="insights-container" id="insightsContainer"></div>
                
                <div class="wisdom-section">
                    <h3 class="wisdom-title">üî• Kevin Lisboa's High Performance Wisdom</h3>
                    <div class="wisdom-quote" id="dailyWisdom"></div>
                </div>
            </div>

            <!-- Data Controls -->
            <div class="data-controls">
                <button class="btn btn-primary" onclick="exportData()">üì§ Export Data</button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• Import Data</button>
                <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(event)">
            </div>
        </div>
    </div>

    <!-- Modal for Adding Practices -->
    <div id="practiceModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Add New Practice</h3>
            <div class="form-group">
                <label class="form-label">Practice Description</label>
                <input type="text" class="form-input" id="practiceInput" placeholder="Enter your daily practice...">
            </div>
            <div class="form-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addNewPractice()">Add Practice</button>
            </div>
        </div>
    </div>

    <!-- Journal History Modal -->
    <div id="journalHistoryModal" class="journal-history-modal">
        <div class="journal-history-content">
            <h3 class="modal-title">üìö Journal History</h3>
            <div id="journalHistoryEntries"></div>
            <div class="form-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="closeJournalHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Journal Entry Modal -->
    <div id="editJournalModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">‚úèÔ∏è Edit Journal Entry</h3>
            <div class="form-group">
                <label class="form-label">Content</label>
                <textarea class="form-input" id="editJournalContent" style="min-height: 200px;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Tags (comma separated)</label>
                <input type="text" class="form-input" id="editJournalTags">
            </div>
            <div class="form-buttons">
                <button class="btn btn-secondary" onclick="closeEditJournalModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEditedJournalEntry()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Save Indicator -->
    <div class="save-indicator" id="saveIndicator">üíæ Auto-saved</div>

    <script>
        // Core Application Data
        const appData = {
            habits: {
                clarity: {
                    name: "Seek Clarity",
                    icon: "üîç",
                    practices: [
                        "I defined my goals and priorities for today",
                        "I visualized my ideal future self",
                        "I reviewed my core values and mission"
                    ]
                },
                energy: {
                    name: "Generate Energy",
                    icon: "‚ö°",
                    practices: [
                        "I exercised or moved my body",
                        "I ate nutritious meals",
                        "I got quality sleep (7+ hours)"
                    ]
                },
                necessity: {
                    name: "Raise Necessity",
                    icon: "üî•",
                    practices: [
                        "I connected with my 'why' and deeper purpose",
                        "I set high standards for myself",
                        "I made commitments that stretch me"
                    ]
                },
                productivity: {
                    name: "Increase Productivity",
                    icon: "üéØ",
                    practices: [
                        "I focused on my most important tasks first",
                        "I eliminated distractions during work",
                        "I batched similar activities together"
                    ]
                },
                influence: {
                    name: "Develop Influence",
                    icon: "ü§ù",
                    practices: [
                        "I taught, shared, or mentored someone",
                        "I challenged someone to grow",
                        "I demonstrated leadership in my actions"
                    ]
                },
                courage: {
                    name: "Demonstrate Courage",
                    icon: "üí™",
                    practices: [
                        "I spoke up for what I believe in",
                        "I took action despite fear or uncertainty",
                        "I tried something new or challenging"
                    ]
                }
            },
            dailyScores: {},
            reflections: {},
            tomorrowPlans: {},
            journalEntries: {},
            journalTags: [],
            lastResetDate: getDateKey(new Date()) // Track when habits were last reset
        };

        // Enhanced Coaching Prompts
        const reflectionPrompts = {
            highPerformance: [
                "What specific moment today made me feel most ALIVE and engaged? How can I create more of these moments?",
                "Which of my actions today directly moved me closer to my 90-day goals? What pattern do I notice?",
                "When did I feel most in flow today? What conditions created that state, and how do I replicate it?",
                "What did I do today that my future self will thank me for? What would disappoint my future self?"
            ],
            
            lowPerformance: [
                "What story did I tell myself today that held me back? Is that story true or just fear talking?",
                "When did I choose comfort over growth today? What was I avoiding, and why?",
                "What would I do differently if I had TODAY to live over again? Be specific - hour by hour.",
                "What support, resource, or mindset shift do I need to perform at my potential tomorrow?"
            ],
            
            habitSpecific: {
                clarity: "Did I make decisions from CLARITY or confusion today? When was I most clear, and what created that clarity?",
                energy: "What drained my energy today vs. what energized me? How do I design tomorrow to maximize my energy?",
                necessity: "Did I feel a sense of urgency and importance around my goals today? If not, what's missing from my WHY?",
                productivity: "What was my #1 most important outcome today? Did I achieve it? If not, what got in the way?",
                influence: "How did I add value to someone else's life today? When did I show up as a leader vs. a follower?",
                courage: "What would I have done today if I was 10% braver? What fear is still running my life?"
            }
        };

        let currentEditingHabit = '';
        let currentViewMonth = new Date();
        let currentViewYear = new Date();
        let currentActiveJournalTab = 'morning';
        let currentlyEditingJournalEntry = null;

        // Application Initialization
        function initializeApp() {
            try {
                checkAndResetHabits();
                loadData();
                updateTimezone();
                renderDailyTracker();
                renderWeeklyReview();
                renderMonthlyView();
                renderYearlyView();
                renderHabitsManagement();
                renderInsights();
                checkMissedDays();
                setupJournalListeners();
                setInterval(updateTimezone, 60000);
                setInterval(saveData, 30000);
                setInterval(checkAndResetHabits, 3600000); // Check every hour for date change
            } catch (error) {
                console.error('App initialization error:', error);
            }
        }

        // Check if habits need to be reset (new day)
        function checkAndResetHabits() {
            try {
                const today = getDateKey(new Date());
                if (appData.lastResetDate !== today) {
                    appData.lastResetDate = today;
                    saveData();
                    renderDailyTracker();
                }
            } catch (error) {
                console.error('Error checking/resetting habits:', error);
            }
        }

        // Timezone Management
        function updateTimezone() {
            try {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const dateString = now.toLocaleDateString([], {weekday: 'long', month: 'short', day: 'numeric'});
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                
                document.getElementById('currentTime').textContent = `üïê ${timeString}`;
                document.getElementById('currentDate').textContent = `üìÖ ${dateString}`;
                document.getElementById('currentZone').textContent = `üåç ${timezone}`;
            } catch (error) {
                console.error('Timezone update error:', error);
            }
        }

        // Section Navigation
        function showSection(sectionName) {
            try {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.getElementById(sectionName).classList.add('active');
                event.target.classList.add('active');
                
                if (sectionName === 'weekly') renderWeeklyReview();
                if (sectionName === 'monthly') renderMonthlyView();
                if (sectionName === 'yearly') renderYearlyView();
                if (sectionName === 'insights') renderInsights();
            } catch (error) {
                console.error('Section navigation error:', error);
            }
        }

        // Alert System
        function checkMissedDays() {
            try {
                const today = getDateKey(new Date());
                const missedDays = [];
                
                // Check last 2 days individually
                for (let daysBack = 1; daysBack <= 2; daysBack++) {
                    const checkDate = addDays(new Date(), -daysBack);
                    const dateKey = getDateKey(checkDate);
                    const score = calculateDayScore(dateKey);
                    
                    if (score === 0) {
                        const dayName = checkDate.toLocaleDateString([], {weekday: 'long', month: 'short', day: 'numeric'});
                        missedDays.push({ dateKey, dayName, daysAgo: daysBack });
                    }
                }
                
                const alertsContainer = document.getElementById('alertsContainer');
                if (!alertsContainer) return;
                
                if (missedDays.length > 0) {
                    showMissedAlert(missedDays);
                } else {
                    showStreakBanner();
                }
            } catch (error) {
                console.error('Error checking missed days:', error);
            }
        }

        function showMissedAlert(missedDays) {
            try {
                const alertsContainer = document.getElementById('alertsContainer');
                const daysList = missedDays.map(day => `<li>${day.dayName} (${day.daysAgo} day${day.daysAgo > 1 ? 's' : ''} ago)</li>`).join('');
                
                alertsContainer.innerHTML = `
                    <div class="missed-alert">
                        <h3>‚ö†Ô∏è CONSISTENCY ALERT!</h3>
                        <p><strong>High performers NEVER let gaps become habits!</strong> You missed these days:</p>
                        <ul>${daysList}</ul>
                        <p><strong>Kevin Lisboa says:</strong> "The quality of your life is determined by the quality of your daily practices. Get back in there!"</p>
                        <div class="alert-actions">
                            <button class="alert-btn" onclick="quickFillDay('${missedDays[0].dateKey}')">üî• Quick Recovery</button>
                            <button class="alert-btn" onclick="dismissAlert()">‚úÖ I'm Back On Track</button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error showing missed alert:', error);
            }
        }

        function showStreakBanner() {
            try {
                const alertsContainer = document.getElementById('alertsContainer');
                const streak = calculateCurrentStreak();
                const weeklyAvg = calculateWeeklyAverage();
                
                if (streak > 0 || weeklyAvg > 60) {
                    let message = '';
                    if (streak >= 7) {
                        message = `üî• ${streak} DAY STREAK! You're absolutely CRUSHING this high performance journey!`;
                    } else if (streak >= 3) {
                        message = `üí™ ${streak} days strong! You're building UNSTOPPABLE momentum!`;
                    } else if (weeklyAvg > 80) {
                        message = `‚≠ê ${weeklyAvg}% weekly average - You're in the HIGH PERFORMANCE ZONE!`;
                    } else if (weeklyAvg > 60) {
                        message = `üìà ${weeklyAvg}% this week - Keep pushing forward, champion!`;
                    }
                    
                    if (message) {
                        alertsContainer.innerHTML = `<div class="streak-banner">${message}</div>`;
                    }
                }
            } catch (error) {
                console.error('Error showing streak banner:', error);
            }
        }

        function quickFillDay(dateKey) {
            try {
                if (!appData.dailyScores[dateKey]) {
                    appData.dailyScores[dateKey] = {};
                }
                
                Object.keys(appData.habits).forEach(habitKey => {
                    const practiceCount = appData.habits[habitKey].practices.length;
                    const halfCount = Math.ceil(practiceCount / 2);
                    
                    appData.dailyScores[dateKey][habitKey] = {};
                    for (let i = 0; i < halfCount; i++) {
                        appData.dailyScores[dateKey][habitKey][i] = true;
                    }
                });
                
                const dayName = new Date(dateKey).toLocaleDateString([], {weekday: 'long'});
                appData.reflections[dateKey] = `Quick fill for ${dayName} - staying committed to my high performance journey.`;
                
                saveData();
                checkMissedDays();
                alert(`‚úÖ ${dayName} filled with baseline completion. You're back on track!`);
            } catch (error) {
                console.error('Error in quick fill day:', error);
            }
        }

        function dismissAlert() {
            try {
                document.getElementById('alertsContainer').innerHTML = '';
                showStreakBanner();
            } catch (error) {
                console.error('Error dismissing alert:', error);
            }
        }

        // Daily Tracker
        function renderDailyTracker() {
            try {
                const container = document.getElementById('habitsGrid');
                const today = getDateKey(new Date());
                
                container.innerHTML = '';
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const practicesHtml = habit.practices.map((practice, index) => {
                        const isChecked = appData.dailyScores[today]?.[habitKey]?.[index] || false;
                        return `
                            <div class="practice-item">
                                <input type="checkbox" class="practice-checkbox" 
                                       ${isChecked ? 'checked' : ''} 
                                       onchange="updatePractice('${habitKey}', ${index}, this.checked)">
                                <span class="practice-text">${practice}</span>
                            </div>
                        `;
                    }).join('');

                    const score = calculateHabitScore(habitKey, today);
                    
                    const habitCard = document.createElement('div');
                    habitCard.className = 'habit-card';
                    habitCard.innerHTML = `
                        <div class="habit-header">
                            <span class="habit-icon">${habit.icon}</span>
                            <div class="habit-title">${habit.name}</div>
                        </div>
                        <div class="practices-list">
                            ${practicesHtml}
                        </div>
                        <div class="habit-score">
                            <div class="score-value">${score}%</div>
                            <div class="score-label">Today's Score</div>
                        </div>
                    `;
                    
                    container.appendChild(habitCard);
                });

                renderCoachingPrompts();
                loadTomorrowPlan();
                loadJournalEntries();
            } catch (error) {
                console.error('Error rendering daily tracker:', error);
            }
        }

        function updatePractice(habitKey, practiceIndex, isChecked) {
            try {
                const today = getDateKey(new Date());
                
                if (!appData.dailyScores[today]) {
                    appData.dailyScores[today] = {};
                }
                if (!appData.dailyScores[today][habitKey]) {
                    appData.dailyScores[today][habitKey] = {};
                }
                
                appData.dailyScores[today][habitKey][practiceIndex] = isChecked;
                
                const score = calculateHabitScore(habitKey, today);
                const habitCards = document.querySelectorAll('.habit-card');
                const habitIndex = Object.keys(appData.habits).indexOf(habitKey);
                const scoreElement = habitCards[habitIndex]?.querySelector('.score-value');
                if (scoreElement) {
                    scoreElement.textContent = `${score}%`;
                }
                
                // Update coaching prompts based on new performance
                renderCoachingPrompts();
                
                saveData();
            } catch (error) {
                console.error('Error updating practice:', error);
            }
        }

        // Journal System
        function showJournalTab(tabName) {
            try {
                document.querySelectorAll('.journal-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelectorAll('.journal-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                event.target.classList.add('active');
                document.getElementById(tabName).classList.add('active');
                currentActiveJournalTab = tabName;
            } catch (error) {
                console.error('Error switching journal tab:', error);
            }
        }

        function setupJournalListeners() {
            try {
                const journalTypes = ['morning', 'gratitude', 'learning', 'breakthrough', 'free'];
                
                journalTypes.forEach(type => {
                    const textarea = document.getElementById(`${type}Journal`);
                    const wordCountElement = document.getElementById(`${type}WordCount`);
                    
                    if (textarea && wordCountElement) {
                        textarea.addEventListener('input', function() {
                            try {
                                const words = this.value.trim().split(/\s+/).filter(word => word.length > 0);
                                const wordCount = words.length;
                                let countText = `Words: ${wordCount}`;
                                
                                if (type === 'morning') {
                                    countText += ` | Target: 300+`;
                                    if (wordCount >= 300) {
                                        countText += ' ‚úÖ';
                                    }
                                }
                                
                                wordCountElement.textContent = countText;
                            } catch (error) {
                                console.error('Error updating word count:', error);
                            }
                        });
                    }
                });
            } catch (error) {
                console.error('Error setting up journal listeners:', error);
            }
        }

        function saveJournal() {
            try {
                const today = getDateKey(new Date());
                
                if (!appData.journalEntries[today]) {
                    appData.journalEntries[today] = {};
                }
                
                const journalTypes = ['morning', 'gratitude', 'learning', 'breakthrough', 'free'];
                let saveCount = 0;
                
                journalTypes.forEach(type => {
                    const contentElement = document.getElementById(`${type}Journal`);
                    const tagsElement = document.getElementById(`${type}Tags`);
                    
                    if (contentElement && tagsElement) {
                        const content = contentElement.value;
                        const tags = tagsElement.value;
                        
                        if (content.trim()) {
                            const words = content.trim().split(/\s+/).filter(word => word.length > 0);
                            appData.journalEntries[today][type] = {
                                content: content,
                                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
                                wordCount: words.length,
                                timestamp: new Date().toISOString()
                            };
                            
                            // Add tags to global tag array
                            const tagArray = tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                            tagArray.forEach(tag => {
                                if (!appData.journalTags.includes(tag)) {
                                    appData.journalTags.push(tag);
                                }
                            });
                            
                            saveCount++;
                            
                            // Clear the textarea after save if configured to do so
                            if (type === currentActiveJournalTab) {
                                contentElement.value = '';
                                tagsElement.value = '';
                                const event = new Event('input');
                                contentElement.dispatchEvent(event);
                            }
                        }
                    }
                });
                
                saveData();
                showSaveIndicator();
                alert(`üìù ${saveCount} journal entries saved! Your thoughts are captured for growth and reflection.`);
            } catch (error) {
                console.error('Error saving journal:', error);
            }
        }

        function loadJournalEntries() {
            try {
                const today = getDateKey(new Date());
                const todayEntries = appData.journalEntries[today];
                
                if (todayEntries) {
                    Object.entries(todayEntries).forEach(([type, entry]) => {
                        const textarea = document.getElementById(`${type}Journal`);
                        const tagsInput = document.getElementById(`${type}Tags`);
                        
                        if (textarea && entry.content) {
                            textarea.value = entry.content;
                            
                            // Update word count
                            const event = new Event('input');
                            textarea.dispatchEvent(event);
                        }
                        
                        if (tagsInput && entry.tags) {
                            tagsInput.value = entry.tags.join(', ');
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading journal entries:', error);
            }
        }

        function showJournalHistory() {
            try {
                const container = document.getElementById('journalHistoryEntries');
                container.innerHTML = '';
                
                // Sort journal entries by date (newest first)
                const sortedDates = Object.keys(appData.journalEntries).sort((a, b) => {
                    return new Date(b) - new Date(a);
                });
                
                sortedDates.forEach(date => {
                    const dateObj = new Date(date);
                    const dateFormatted = dateObj.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    
                    const dateHeader = document.createElement('h4');
                    dateHeader.style.margin = '15px 0 10px';
                    dateHeader.style.color = '#2c3e50';
                    dateHeader.textContent = dateFormatted;
                    container.appendChild(dateHeader);
                    
                    const dayEntries = appData.journalEntries[date];
                    Object.entries(dayEntries).forEach(([type, entry]) => {
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'journal-entry';
                        
                        const typeTitles = {
                            morning: 'üåÖ Morning Pages',
                            gratitude: 'üôè Gratitude',
                            learning: 'üìö Learning Log',
                            breakthrough: 'üí° Breakthroughs',
                            free: '‚úçÔ∏è Free Write'
                        };
                        
                        entryDiv.innerHTML = `
                            <div class="journal-entry-header">
                                <span>${typeTitles[type] || type}</span>
                                <span>${entry.wordCount} words</span>
                            </div>
                            <div class="journal-entry-content">${entry.content.replace(/\n/g, '<br>')}</div>
                            ${entry.tags && entry.tags.length > 0 ? 
                                `<div class="journal-entry-tags">Tags: ${entry.tags.join(', ')}</div>` : ''}
                            <div class="journal-entry-actions">
                                <button class="edit-journal-btn" onclick="editJournalEntry('${date}', '${type}')">Edit</button>
                            </div>
                        `;
                        
                        container.appendChild(entryDiv);
                    });
                });
                
                if (sortedDates.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">No journal entries found. Start writing to see your history here!</p>';
                }
                
                document.getElementById('journalHistoryModal').style.display = 'block';
            } catch (error) {
                console.error('Error showing journal history:', error);
            }
        }

        function closeJournalHistoryModal() {
            document.getElementById('journalHistoryModal').style.display = 'none';
        }

        function editJournalEntry(date, type) {
            try {
                const entry = appData.journalEntries[date][type];
                if (!entry) return;
                
                document.getElementById('editJournalContent').value = entry.content;
                document.getElementById('editJournalTags').value = entry.tags ? entry.tags.join(', ') : '';
                
                currentlyEditingJournalEntry = { date, type };
                document.getElementById('editJournalModal').style.display = 'block';
            } catch (error) {
                console.error('Error editing journal entry:', error);
            }
        }

        function closeEditJournalModal() {
            document.getElementById('editJournalModal').style.display = 'none';
            currentlyEditingJournalEntry = null;
        }

        function saveEditedJournalEntry() {
            try {
                if (!currentlyEditingJournalEntry) return;
                
                const { date, type } = currentlyEditingJournalEntry;
                const content = document.getElementById('editJournalContent').value;
                const tags = document.getElementById('editJournalTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                
                if (!appData.journalEntries[date]) {
                    appData.journalEntries[date] = {};
                }
                
                appData.journalEntries[date][type] = {
                    content: content,
                    tags: tags,
                    wordCount: content.trim().split(/\s+/).filter(word => word.length > 0).length,
                    timestamp: new Date().toISOString()
                };
                
                // Update tags in global tag array
                tags.forEach(tag => {
                    if (!appData.journalTags.includes(tag)) {
                        appData.journalTags.push(tag);
                    }
                });
                
                saveData();
                closeEditJournalModal();
                showJournalHistory(); // Refresh the view
                showSaveIndicator();
            } catch (error) {
                console.error('Error saving edited journal entry:', error);
            }
        }

        // Enhanced Reflection with Coaching Prompts
        function renderCoachingPrompts() {
            try {
                const container = document.getElementById('coachingPrompts');
                const today = getDateKey(new Date());
                const todayScore = calculateDayScore(today);
                
                // Determine which prompts to show based on performance
                let selectedPrompts = [];
                
                if (todayScore >= 70) {
                    selectedPrompts = getRandomPrompts(reflectionPrompts.highPerformance, 2);
                } else {
                    selectedPrompts = getRandomPrompts(reflectionPrompts.lowPerformance, 2);
                }
                
                // Add one habit-specific prompt
                const lowestHabit = getLowestHabitToday(today);
                const habitPrompt = reflectionPrompts.habitSpecific[lowestHabit];
                
                container.innerHTML = `
                    <div class="prompt-card">
                        <div class="prompt-header">
                            <span class="prompt-icon">ü§î</span>
                            <div class="prompt-title">Today's Coaching Question</div>
                        </div>
                        <p class="prompt-text">${selectedPrompts[0]}</p>
                        <textarea class="reflection-input" id="reflection1" placeholder="Write your response..."></textarea>
                    </div>
                    
                    <div class="prompt-card">
                        <div class="prompt-header">
                            <span class="prompt-icon">üéØ</span>
                            <div class="prompt-title">Performance Pattern Recognition</div>
                        </div>
                        <p class="prompt-text">${selectedPrompts[1] || selectedPrompts[0]}</p>
                        <textarea class="reflection-input" id="reflection2" placeholder="Be specific..."></textarea>
                    </div>
                    
                    <div class="prompt-card">
                        <div class="prompt-header">
                            <span class="prompt-icon">üöÄ</span>
                            <div class="prompt-title">Growth Edge Discovery</div>
                        </div>
                        <p class="prompt-text">${habitPrompt}</p>
                        <textarea class="reflection-input" id="reflection3" placeholder="Go deeper..."></textarea>
                    </div>
                `;
                
                // Load existing reflections
                const existingReflections = appData.reflections[today];
                if (existingReflections) {
                    try {
                        const reflectionData = JSON.parse(existingReflections);
                        if (reflectionData.reflection1) document.getElementById('reflection1').value = reflectionData.reflection1;
                        if (reflectionData.reflection2) document.getElementById('reflection2').value = reflectionData.reflection2;
                        if (reflectionData.reflection3) document.getElementById('reflection3').value = reflectionData.reflection3;
                    } catch (e) {
                        // Handle legacy format
                        document.getElementById('reflection1').value = existingReflections;
                    }
                }
            } catch (error) {
                console.error('Error rendering coaching prompts:', error);
            }
        }

        function getRandomPrompts(promptArray, count) {
            const shuffled = [...promptArray].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function getLowestHabitToday(date) {
            let lowestHabit = 'clarity';
            let lowestScore = 101;
            
            Object.keys(appData.habits).forEach(habitKey => {
                const score = calculateHabitScore(habitKey, date);
                if (score < lowestScore) {
                    lowestScore = score;
                    lowestHabit = habitKey;
                }
            });
            
            return lowestHabit;
        }

        function saveReflection() {
            try {
                const today = getDateKey(new Date());
                const reflection1 = document.getElementById('reflection1').value;
                const reflection2 = document.getElementById('reflection2').value;
                const reflection3 = document.getElementById('reflection3').value;
                
                const reflectionData = {
                    reflection1,
                    reflection2,
                    reflection3,
                    date: today
                };
                
                appData.reflections[today] = JSON.stringify(reflectionData);
                saveData();
                showSaveIndicator();
            } catch (error) {
                console.error('Error saving reflection:', error);
            }
        }

        // Tomorrow's Performance Planning
        function loadTomorrowPlan() {
            try {
                const today = getDateKey(new Date());
                const existingPlan = appData.tomorrowPlans[today];
                
                if (existingPlan) {
                    try {
                        const planData = JSON.parse(existingPlan);
                        document.getElementById('priorityInput').value = planData.priority || '';
                        document.getElementById('bedtimeInput').value = planData.bedtime || '';
                        document.getElementById('wakeupInput').value = planData.wakeup || '';
                        document.getElementById('peakEnergyInput').value = planData.peakEnergy || '';
                        document.getElementById('peakActivityInput').value = planData.peakActivity || '';
                        document.getElementById('habitIntentionsInput').value = planData.habitIntentions || '';
                        document.getElementById('obstaclesInput').value = planData.obstacles || '';
                        document.getElementById('identityInput').value = planData.identity || '';
                    } catch (e) {
                        console.log('Error loading tomorrow plan:', e);
                    }
                }
            } catch (error) {
                console.error('Error loading tomorrow plan:', error);
            }
        }

        function saveTomorrowPlan() {
            try {
                const today = getDateKey(new Date());
                
                const planData = {
                    priority: document.getElementById('priorityInput').value,
                    bedtime: document.getElementById('bedtimeInput').value,
                    wakeup: document.getElementById('wakeupInput').value,
                    peakEnergy: document.getElementById('peakEnergyInput').value,
                    peakActivity: document.getElementById('peakActivityInput').value,
                    habitIntentions: document.getElementById('habitIntentionsInput').value,
                    obstacles: document.getElementById('obstaclesInput').value,
                    identity: document.getElementById('identityInput').value,
                    date: today
                };
                
                appData.tomorrowPlans[today] = JSON.stringify(planData);
                saveData();
                showSaveIndicator();
                
                alert('üîí Tomorrow\'s high-performance plan is locked in! You\'re ready for excellence.');
            } catch (error) {
                console.error('Error saving tomorrow plan:', error);
            }
        }

        // Weekly Review
        function renderWeeklyReview() {
            try {
                renderWeeklyCards();
                renderWeeklyHistory();
            } catch (error) {
                console.error('Error rendering weekly review:', error);
            }
        }

        function renderWeeklyCards() {
            try {
                const container = document.getElementById('weeklyGrid');
                const weekDates = getLast7Days();
                
                container.innerHTML = '';
                
                const overallScore = calculateWeeklyAverage();
                const overallCard = document.createElement('div');
                overallCard.className = 'overview-card';
                overallCard.innerHTML = `
                    <div class="overview-score">${overallScore}%</div>
                    <div class="overview-label">Overall Performance</div>
                `;
                container.appendChild(overallCard);
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const weeklyScore = calculateWeeklyHabitScore(habitKey, weekDates);
                    const card = document.createElement('div');
                    card.className = 'overview-card';
                    card.innerHTML = `
                        <div class="overview-score">${weeklyScore}%</div>
                        <div class="overview-label">${habit.icon} ${habit.name}</div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error rendering weekly cards:', error);
            }
        }

        function renderWeeklyHistory() {
            try {
                const container = document.getElementById('daysGrid');
                const weekDates = getLast7Days();
                
                container.innerHTML = '';
                
                weekDates.forEach(dateKey => {
                    const dayScore = calculateDayScore(dateKey);
                    const dayName = new Date(dateKey).toLocaleDateString('en-US', { weekday: 'short' });
                    
                    const dayBox = document.createElement('div');
                    dayBox.className = 'day-box';
                    
                    if (dayScore >= 80) dayBox.classList.add('score-high');
                    else if (dayScore >= 50) dayBox.classList.add('score-medium');
                    else if (dayScore > 0) dayBox.classList.add('score-low');
                    
                    dayBox.innerHTML = `
                        <div>${dayName}</div>
                        <div>${dayScore}%</div>
                    `;
                    
                    container.appendChild(dayBox);
                });
            } catch (error) {
                console.error('Error rendering weekly history:', error);
            }
        }

        // Monthly View
        function renderMonthlyView() {
            try {
                updateMonthDisplay();
                renderMonthlyOverview();
                renderMonthlyCalendar();
                renderMonthlyTrends();
            } catch (error) {
                console.error('Error rendering monthly view:', error);
            }
        }

        function changeMonth(direction) {
            try {
                currentViewMonth.setMonth(currentViewMonth.getMonth() + direction);
                renderMonthlyView();
            } catch (error) {
                console.error('Error changing month:', error);
            }
        }

        function updateMonthDisplay() {
            try {
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                const display = `${monthNames[currentViewMonth.getMonth()]} ${currentViewMonth.getFullYear()}`;
                document.getElementById('currentMonth').textContent = display;
            } catch (error) {
                console.error('Error updating month display:', error);
            }
        }

        function renderMonthlyOverview() {
            try {
                const container = document.getElementById('monthlyOverview');
                const monthDates = getMonthDates(currentViewMonth);
                
                container.innerHTML = '';
                
                const monthlyAvg = calculateMonthlyAverage(monthDates);
                const overallCard = document.createElement('div');
                overallCard.className = 'overview-card';
                overallCard.innerHTML = `
                    <div class="overview-score">${monthlyAvg}%</div>
                    <div class="overview-label">Monthly Average</div>
                `;
                container.appendChild(overallCard);
                
                const highPerfDays = monthDates.filter(date => calculateDayScore(date) >= 80).length;
                const daysCard = document.createElement('div');
                daysCard.className = 'overview-card';
                daysCard.innerHTML = `
                    <div class="overview-score">${highPerfDays}</div>
                    <div class="overview-label">High Performance Days</div>
                `;
                container.appendChild(daysCard);
                
                const bestStreak = calculateBestMonthlyStreak(monthDates);
                const streakCard = document.createElement('div');
                streakCard.className = 'overview-card';
                streakCard.innerHTML = `
                    <div class="overview-score">${bestStreak}</div>
                    <div class="overview-label">Best Streak</div>
                `;
                container.appendChild(streakCard);
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const monthlyScore = calculateMonthlyHabitScore(habitKey, monthDates);
                    const card = document.createElement('div');
                    card.className = 'overview-card';
                    card.innerHTML = `
                        <div class="overview-score">${monthlyScore}%</div>
                        <div class="overview-label">${habit.icon} ${habit.name}</div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error rendering monthly overview:', error);
            }
        }

        function renderMonthlyCalendar() {
            try {
                const container = document.getElementById('monthlyCalendar');
                container.innerHTML = '';
                
                const year = currentViewMonth.getFullYear();
                const month = currentViewMonth.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const today = getDateKey(new Date());
                
                for (let i = 0; i < 42; i++) {
                    const cellDate = new Date(startDate);
                    cellDate.setDate(startDate.getDate() + i);
                    const dateKey = getDateKey(cellDate);
                    const dayScore = calculateDayScore(dateKey);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    if (cellDate.getMonth() !== month) {
                        dayElement.classList.add('other-month');
                    } else if (dateKey === today) {
                        dayElement.classList.add('today');
                    }
                    
                    if (dayScore === 0) {
                        dayElement.classList.add('no-data');
                    } else if (dayScore < 50) {
                        dayElement.classList.add('low-score');
                    } else if (dayScore < 80) {
                        dayElement.classList.add('mid-score');
                    } else {
                        dayElement.classList.add('high-score');
                    }
                    
                    dayElement.innerHTML = `
                        <div>${cellDate.getDate()}</div>
                        ${dayScore > 0 ? `<div style="font-size: 10px;">${dayScore}%</div>` : ''}
                    `;
                    
                    container.appendChild(dayElement);
                }
            } catch (error) {
                console.error('Error rendering monthly calendar:', error);
            }
        }

        function renderMonthlyTrends() {
            try {
                const container = document.getElementById('monthlyTrends');
                const currentMonthDates = getMonthDates(currentViewMonth);
                const previousMonth = new Date(currentViewMonth);
                previousMonth.setMonth(previousMonth.getMonth() - 1);
                const previousMonthDates = getMonthDates(previousMonth);
                
                container.innerHTML = '';
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const currentScore = calculateMonthlyHabitScore(habitKey, currentMonthDates);
                    const previousScore = calculateMonthlyHabitScore(habitKey, previousMonthDates);
                    const change = currentScore - previousScore;
                    
                    let trendClass = 'trend-stable';
                    let trendIcon = '‚û°Ô∏è';
                    let trendText = 'Stable';
                    
                    if (change > 5) {
                        trendClass = 'trend-up';
                        trendIcon = 'üìà';
                        trendText = `+${change.toFixed(1)}%`;
                    } else if (change < -5) {
                        trendClass = 'trend-down';
                        trendIcon = 'üìâ';
                        trendText = `${change.toFixed(1)}%`;
                    }
                    
                    const trendCard = document.createElement('div');
                    trendCard.className = 'trend-card';
                    trendCard.innerHTML = `
                        <div class="trend-info">
                            <h4>${habit.icon} ${habit.name}</h4>
                            <div class="trend-details">Current: ${currentScore}% | Previous: ${previousScore}%</div>
                        </div>
                        <div class="trend-indicator ${trendClass}">
                            ${trendIcon} ${trendText}
                        </div>
                    `;
                    container.appendChild(trendCard);
                });
            } catch (error) {
                console.error('Error rendering monthly trends:', error);
            }
        }

        // Yearly View
        function renderYearlyView() {
            try {
                updateYearDisplay();
                renderYearlyOverview();
                renderYearlyChart();
                renderSeasonalAnalysis();
                renderYearlyInsights();
            } catch (error) {
                console.error('Error rendering yearly view:', error);
            }
        }

        function changeYear(direction) {
            try {
                currentViewYear.setFullYear(currentViewYear.getFullYear() + direction);
                renderYearlyView();
            } catch (error) {
                console.error('Error changing year:', error);
            }
        }

        function updateYearDisplay() {
            try {
                document.getElementById('currentYear').textContent = currentViewYear.getFullYear();
            } catch (error) {
                console.error('Error updating year display:', error);
            }
        }

        function renderYearlyOverview() {
            try {
                const container = document.getElementById('yearlyOverview');
                const year = currentViewYear.getFullYear();
                
                container.innerHTML = '';
                
                const yearlyMetrics = calculateYearlyMetrics(year);
                
                const avgCard = document.createElement('div');
                avgCard.className = 'overview-card';
                avgCard.innerHTML = `
                    <div class="overview-score">${yearlyMetrics.average}%</div>
                    <div class="overview-label">Yearly Average</div>
                `;
                container.appendChild(avgCard);
                
                const daysCard = document.createElement('div');
                daysCard.className = 'overview-card';
                daysCard.innerHTML = `
                    <div class="overview-score">${yearlyMetrics.highPerfDays}</div>
                    <div class="overview-label">High Performance Days</div>
                `;
                container.appendChild(daysCard);
                
                const bestMonthCard = document.createElement('div');
                bestMonthCard.className = 'overview-card';
                bestMonthCard.innerHTML = `
                    <div class="overview-score">${yearlyMetrics.bestMonth.name}</div>
                    <div class="overview-label">Best Month (${yearlyMetrics.bestMonth.score}%)</div>
                `;
                container.appendChild(bestMonthCard);
                
                const streakCard = document.createElement('div');
                streakCard.className = 'overview-card';
                streakCard.innerHTML = `
                    <div class="overview-score">${yearlyMetrics.longestStreak}</div>
                    <div class="overview-label">Longest Streak</div>
                `;
                container.appendChild(streakCard);
            } catch (error) {
                console.error('Error rendering yearly overview:', error);
            }
        }

        function renderYearlyChart() {
            try {
                const container = document.getElementById('yearlyChart');
                const year = currentViewYear.getFullYear();
                
                container.innerHTML = '';
                
                const chartContainer = document.createElement('div');
                chartContainer.className = 'chart-bars';
                
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                
                monthNames.forEach((monthName, index) => {
                    const monthDate = new Date(year, index, 1);
                    const monthDates = getMonthDates(monthDate);
                    const monthScore = calculateMonthlyAverage(monthDates);
                    
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.height = `${(monthScore / 100) * 170}px`;
                    bar.innerHTML = `
                        <div class="chart-bar-value">${monthScore}%</div>
                        <div class="chart-bar-label">${monthName}</div>
                    `;
                    
                    chartContainer.appendChild(bar);
                });
                
                container.appendChild(chartContainer);
            } catch (error) {
                console.error('Error rendering yearly chart:', error);
            }
        }

        function renderSeasonalAnalysis() {
            try {
                const container = document.getElementById('seasonalGrid');
                const year = currentViewYear.getFullYear();
                
                container.innerHTML = '';
                
                const seasons = [
                    { name: 'Q1 (Jan-Mar)', months: [0, 1, 2], emoji: '‚ùÑÔ∏è' },
                    { name: 'Q2 (Apr-Jun)', months: [3, 4, 5], emoji: 'üå∏' },
                    { name: 'Q3 (Jul-Sep)', months: [6, 7, 8], emoji: '‚òÄÔ∏è' },
                    { name: 'Q4 (Oct-Dec)', months: [9, 10, 11], emoji: 'üçÇ' }
                ];
                
                // Calculate scores for each season
                const seasonScores = seasons.map((season, index) => {
                    let totalScore = 0;
                    season.months.forEach(monthIndex => {
                        const monthDate = new Date(year, monthIndex, 1);
                        const monthDates = getMonthDates(monthDate);
                        totalScore += calculateMonthlyAverage(monthDates);
                    });
                    const avgScore = Math.round(totalScore / 3);
                    return avgScore;
                });
                
                // Find best season (only if there's a clear winner)
                const maxScore = Math.max(...seasonScores);
                let bestSeasonIndex = -1;
                
                // Only mark as "best" if score > 0 and is unique highest
                if (maxScore > 0) {
                    const winnersCount = seasonScores.filter(score => score === maxScore).length;
                    if (winnersCount === 1) {
                        bestSeasonIndex = seasonScores.indexOf(maxScore);
                    }
                }
                
                // If we're viewing current year and no clear winner, highlight current season
                if (bestSeasonIndex === -1 && year === new Date().getFullYear()) {
                    const currentMonth = new Date().getMonth();
                    bestSeasonIndex = Math.floor(currentMonth / 3); // 0-2=Q1, 3-5=Q2, 6-8=Q3, 9-11=Q4
                }
                
                seasons.forEach((season, index) => {
                    const card = document.createElement('div');
                    card.className = 'season-card';
                    if (index === bestSeasonIndex) {
                        card.classList.add('best-season');
                    }
                    
                    card.innerHTML = `
                        <div class="season-title">${season.emoji} ${season.name}</div>
                        <div class="season-score">${seasonScores[index]}%</div>
                        <div class="season-label">Average Performance</div>
                    `;
                    
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error rendering seasonal analysis:', error);
            }
        }

        function renderYearlyInsights() {
            try {
                const container = document.getElementById('yearlyInsightCards');
                const year = currentViewYear.getFullYear();
                const yearlyMetrics = calculateYearlyMetrics(year);
                
                container.innerHTML = `
                    <div class="yearly-insight-grid">
                        <div class="yearly-insight-card">
                            <div class="insight-header">
                                <div class="insight-emoji">üìà</div>
                                <div class="insight-title">Growth Rate</div>
                            </div>
                            <div class="insight-content">
                                <div class="insight-stat">${yearlyMetrics.growthRate}%</div>
                                Year-over-year improvement from first half to second half of the year.
                            </div>
                        </div>
                        
                        <div class="yearly-insight-card">
                            <div class="insight-header">
                                <div class="insight-emoji">üéØ</div>
                                <div class="insight-title">Most Consistent Habit</div>
                            </div>
                            <div class="insight-content">
                                <div class="insight-stat">${yearlyMetrics.mostConsistent.icon} ${yearlyMetrics.mostConsistent.name}</div>
                                Your most reliable habit with ${yearlyMetrics.mostConsistent.score}% yearly average.
                            </div>
                        </div>
                        
                        <div class="yearly-insight-card">
                            <div class="insight-header">
                                <div class="insight-emoji">üöÄ</div>
                                <div class="insight-title">Growth Opportunity</div>
                            </div>
                            <div class="insight-content">
                                <div class="insight-stat">${yearlyMetrics.growthArea.icon} ${yearlyMetrics.growthArea.name}</div>
                                Focus here for maximum impact. Current yearly average: ${yearlyMetrics.growthArea.score}%.
                            </div>
                        </div>
                        
                        <div class="yearly-insight-card">
                            <div class="insight-header">
                                <div class="insight-emoji">‚≠ê</div>
                                <div class="insight-title">Peak Performance</div>
                            </div>
                            <div class="insight-content">
                                <div class="insight-stat">${yearlyMetrics.bestMonth.name}</div>
                                Your strongest month with ${yearlyMetrics.bestMonth.score}% average performance.
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error rendering yearly insights:', error);
            }
        }

        // Habits Management
        function renderHabitsManagement() {
            try {
                const container = document.getElementById('habitsManagement');
                container.innerHTML = '';
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const practicesHtml = habit.practices.map((practice, index) => `
                        <div class="practice-row">
                            <div class="practice-content">${practice}</div>
                            <button class="delete-btn" onclick="deletePractice('${habitKey}', ${index})">‚úï</button>
                        </div>
                    `).join('');

                    const section = document.createElement('div');
                    section.className = 'habit-section';
                    section.innerHTML = `
                        <div class="section-header">
                            <h3 class="section-title-habits">${habit.icon} ${habit.name}</h3>
                            <button class="add-btn" onclick="openPracticeModal('${habitKey}')">+ Add Practice</button>
                        </div>
                        <div class="practices-container">
                            ${practicesHtml}
                        </div>
                    `;
                    
                    container.appendChild(section);
                });
            } catch (error) {
                console.error('Error rendering habits management:', error);
            }
        }

        function openPracticeModal(habitKey) {
            try {
                currentEditingHabit = habitKey;
                document.getElementById('practiceModal').style.display = 'block';
                document.getElementById('practiceInput').focus();
            } catch (error) {
                console.error('Error opening practice modal:', error);
            }
        }

        function closeModal() {
            try {
                document.getElementById('practiceModal').style.display = 'none';
                document.getElementById('practiceInput').value = '';
                currentEditingHabit = '';
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }

        function addNewPractice() {
            try {
                const practiceText = document.getElementById('practiceInput').value.trim();
                if (practiceText && currentEditingHabit) {
                    appData.habits[currentEditingHabit].practices.push(practiceText);
                    saveData();
                    renderHabitsManagement();
                    renderDailyTracker();
                    closeModal();
                }
            } catch (error) {
                console.error('Error adding new practice:', error);
            }
        }

        function deletePractice(habitKey, practiceIndex) {
            try {
                if (confirm('Are you sure you want to delete this practice?')) {
                    appData.habits[habitKey].practices.splice(practiceIndex, 1);
                    saveData();
                    renderHabitsManagement();
                    renderDailyTracker();
                }
            } catch (error) {
                console.error('Error deleting practice:', error);
            }
        }

        // Insights
        function renderInsights() {
            try {
                const container = document.getElementById('insightsContainer');
                const weekDates = getLast7Days();
                
                const currentStreak = calculateCurrentStreak();
                const bestHabit = getBestHabit(weekDates);
                const improvementArea = getImprovementArea(weekDates);
                const weeklyAvg = calculateWeeklyAverage();
                
                container.innerHTML = `
                    <div class="insight-card">
                        <div class="insight-icon">üî•</div>
                        <div class="insight-value">${currentStreak}</div>
                        <div class="insight-label">Current Streak</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">${bestHabit.icon}</div>
                        <div class="insight-value">${bestHabit.score}%</div>
                        <div class="insight-label">Best: ${bestHabit.name}</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">${improvementArea.icon}</div>
                        <div class="insight-value">${improvementArea.score}%</div>
                        <div class="insight-label">Growth: ${improvementArea.name}</div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">üìä</div>
                        <div class="insight-value">${weeklyAvg}%</div>
                        <div class="insight-label">Weekly Average</div>
                    </div>
                `;
                
                showDailyWisdom();
            } catch (error) {
                console.error('Error rendering insights:', error);
            }
        }

        function showDailyWisdom() {
            try {
                const wisdomQuotes = [
                    "The difference between successful people and everyone else isn't talent, luck, or even effort - it's their habits.",
                    "Clarity precedes success. You can't hit a target you can't see.",
                    "High performers don't just have goals; they have a sense of necessity around their goals.",
                    "Your energy is your life force. Manage it like the precious resource it is.",
                    "Influence is about caring enough about others to challenge them to be better.",
                    "Courage isn't the absence of fear; it's feeling the fear and acting anyway.",
                    "The moment you take responsibility for everything in your life is the moment you can change anything in your life.",
                    "Excellence is not a skill, it's an attitude that becomes a habit.",
                    "You become what you consistently do. Choose your habits wisely.",
                    "High performance isn't about perfection; it's about progression and consistency."
                ];

                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                const todaysWisdom = wisdomQuotes[dayOfYear % wisdomQuotes.length];
                
                document.getElementById('dailyWisdom').textContent = `"${todaysWisdom}"`;
            } catch (error) {
                console.error('Error showing daily wisdom:', error);
            }
        }

        // Calculation Functions
        function calculateHabitScore(habitKey, dateKey) {
            try {
                const scores = appData.dailyScores[dateKey]?.[habitKey];
                if (!scores) return 0;
                
                const totalPractices = appData.habits[habitKey].practices.length;
                const completedPractices = Object.values(scores).filter(Boolean).length;
                
                return Math.round((completedPractices / totalPractices) * 100);
            } catch (error) {
                console.error('Error calculating habit score:', error);
                return 0;
            }
        }

        function calculateDayScore(dateKey) {
            try {
                const habitKeys = Object.keys(appData.habits);
                let totalScore = 0;
                let habitCount = 0;
                
                habitKeys.forEach(habitKey => {
                    const habitScore = calculateHabitScore(habitKey, dateKey);
                    totalScore += habitScore;
                    habitCount++;
                });
                
                return habitCount > 0 ? Math.round(totalScore / habitCount) : 0;
            } catch (error) {
                console.error('Error calculating day score:', error);
                return 0;
            }
        }

        function calculateWeeklyHabitScore(habitKey, weekDates) {
            try {
                let totalScore = 0;
                weekDates.forEach(dateKey => {
                    totalScore += calculateHabitScore(habitKey, dateKey);
                });
                return Math.round(totalScore / weekDates.length);
            } catch (error) {
                console.error('Error calculating weekly habit score:', error);
                return 0;
            }
        }

        function calculateWeeklyAverage() {
            try {
                const weekDates = getLast7Days();
                let totalScore = 0;
                weekDates.forEach(dateKey => {
                    totalScore += calculateDayScore(dateKey);
                });
                return Math.round(totalScore / weekDates.length);
            } catch (error) {
                console.error('Error calculating weekly average:', error);
                return 0;
            }
        }

        function calculateCurrentStreak() {
            try {
                let streak = 0;
                let currentDate = new Date();
                
                while (true) {
                    const dateKey = getDateKey(currentDate);
                    const dayScore = calculateDayScore(dateKey);
                    
                    if (dayScore >= 70) {
                        streak++;
                        currentDate = addDays(currentDate, -1);
                    } else {
                        break;
                    }
                    
                    if (streak > 365) break;
                }
                
                return streak;
            } catch (error) {
                console.error('Error calculating current streak:', error);
                return 0;
            }
        }

        function getBestHabit(weekDates) {
            try {
                let bestHabit = null;
                let bestScore = -1;
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const score = calculateWeeklyHabitScore(habitKey, weekDates);
                    if (score > bestScore) {
                        bestScore = score;
                        bestHabit = { ...habit, score };
                    }
                });
                
                return bestHabit || { icon: 'üéØ', name: 'Keep Going', score: 0 };
            } catch (error) {
                console.error('Error getting best habit:', error);
                return { icon: 'üéØ', name: 'Keep Going', score: 0 };
            }
        }

        function getImprovementArea(weekDates) {
            try {
                let worstHabit = null;
                let worstScore = 101;
                
                Object.entries(appData.habits).forEach(([habitKey, habit]) => {
                    const score = calculateWeeklyHabitScore(habitKey, weekDates);
                    if (score < worstScore) {
                        worstScore = score;
                        worstHabit = { ...habit, score };
                    }
                });
                
                return worstHabit || { icon: 'üöÄ', name: 'All Strong', score: 100 };
            } catch (error) {
                console.error('Error getting improvement area:', error);
                return { icon: 'üöÄ', name: 'All Strong', score: 100 };
            }
        }

        // Helper Functions
        function getMonthDates(date) {
            try {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const dates = [];
                
                for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
                    dates.push(getDateKey(new Date(d)));
                }
                
                return dates;
            } catch (error) {
                console.error('Error getting month dates:', error);
                return [];
            }
        }

        function calculateMonthlyAverage(monthDates) {
            try {
                let totalScore = 0;
                let validDays = 0;
                
                monthDates.forEach(dateKey => {
                    const dayScore = calculateDayScore(dateKey);
                    if (dayScore > 0) {
                        totalScore += dayScore;
                        validDays++;
                    }
                });
                
                return validDays > 0 ? Math.round(totalScore / validDays) : 0;
            } catch (error) {
                console.error('Error calculating monthly average:', error);
                return 0;
            }
        }

        function calculateMonthlyHabitScore(habitKey, monthDates) {
            try {
                let totalScore = 0;
                let validDays = 0;
                
                monthDates.forEach(dateKey => {
                    const habitScore = calculateHabitScore(habitKey, dateKey);
                    totalScore += habitScore;
                    validDays++;
                });
                
                return validDays > 0 ? Math.round(totalScore / validDays) : 0;
            } catch (error) {
                console.error('Error calculating monthly habit score:', error);
                return 0;
            }
        }

        function calculateBestMonthlyStreak(monthDates) {
            try {
                let currentStreak = 0;
                let bestStreak = 0;
                
                monthDates.forEach(dateKey => {
                    const dayScore = calculateDayScore(dateKey);
                    if (dayScore >= 70) {
                        currentStreak++;
                        bestStreak = Math.max(bestStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                });
                
                return bestStreak;
            } catch (error) {
                console.error('Error calculating best monthly streak:', error);
                return 0;
            }
        }

        function calculateYearlyMetrics(year) {
            try {
                const monthlyScores = [];
                let totalHighPerfDays = 0;
                const habitYearlyScores = {};
                
                Object.keys(appData.habits).forEach(habitKey => {
                    habitYearlyScores[habitKey] = [];
                });
                
                for (let month = 0; month < 12; month++) {
                    const monthDate = new Date(year, month, 1);
                    const monthDates = getMonthDates(monthDate);
                    const monthScore = calculateMonthlyAverage(monthDates);
                    
                    monthlyScores.push({
                        month: month,
                        score: monthScore,
                        name: new Date(year, month, 1).toLocaleDateString('en-US', { month: 'long' })
                    });
                    
                    monthDates.forEach(dateKey => {
                        if (calculateDayScore(dateKey) >= 80) {
                            totalHighPerfDays++;
                        }
                    });
                    
                    Object.keys(appData.habits).forEach(habitKey => {
                        const habitScore = calculateMonthlyHabitScore(habitKey, monthDates);
                        habitYearlyScores[habitKey].push(habitScore);
                    });
                }
                
                const bestMonth = monthlyScores.reduce((best, current) => 
                    current.score > best.score ? current : best
                );
                
                const firstHalf = monthlyScores.slice(0, 6).reduce((sum, m) => sum + m.score, 0) / 6;
                const secondHalf = monthlyScores.slice(6).reduce((sum, m) => sum + m.score, 0) / 6;
                const growthRate = firstHalf > 0 ? Math.round(((secondHalf - firstHalf) / firstHalf) * 100) : 0;
                
                let mostConsistent = null;
                let growthArea = null;
                let highestAvg = -1;
                let lowestAvg = 101;
                
                Object.entries(habitYearlyScores).forEach(([habitKey, scores]) => {
                    const avg = scores.reduce((sum, score) => sum + score, 0) / scores.length;
                    
                    if (avg > highestAvg) {
                        highestAvg = avg;
                        mostConsistent = {
                            ...appData.habits[habitKey],
                            score: Math.round(avg)
                        };
                    }
                    
                    if (avg < lowestAvg) {
                        lowestAvg = avg;
                        growthArea = {
                            ...appData.habits[habitKey],
                            score: Math.round(avg)
                        };
                    }
                });
                
                const longestStreak = calculateLongestYearlyStreak(year);
                const yearlyAverage = Math.round(monthlyScores.reduce((sum, m) => sum + m.score, 0) / 12);
                
                return {
                    average: yearlyAverage,
                    highPerfDays: totalHighPerfDays,
                    bestMonth: bestMonth,
                    longestStreak: longestStreak,
                    growthRate: growthRate,
                    mostConsistent: mostConsistent || { icon: 'üéØ', name: 'Keep Going', score: 0 },
                    growthArea: growthArea || { icon: 'üöÄ', name: 'All Strong', score: 100 }
                };
            } catch (error) {
                console.error('Error calculating yearly metrics:', error);
                return {
                    average: 0,
                    highPerfDays: 0,
                    bestMonth: { score: 0, name: 'January' },
                    longestStreak: 0,
                    growthRate: 0,
                    mostConsistent: { icon: 'üéØ', name: 'Keep Going', score: 0 },
                    growthArea: { icon: 'üöÄ', name: 'All Strong', score: 100 }
                };
            }
        }

        function calculateLongestYearlyStreak(year) {
            try {
                let currentStreak = 0;
                let longestStreak = 0;
                
                const startDate = new Date(year, 0, 1);
                const endDate = new Date(year, 11, 31);
                
                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                    const dateKey = getDateKey(d);
                    const dayScore = calculateDayScore(dateKey);
                    
                    if (dayScore >= 70) {
                        currentStreak++;
                        longestStreak = Math.max(longestStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                }
                
                return longestStreak;
            } catch (error) {
                console.error('Error calculating longest yearly streak:', error);
                return 0;
            }
        }

        // Utility Functions
        function getDateKey(date) {
            try {
                return date.toISOString().split('T')[0];
            } catch (error) {
                console.error('Error getting date key:', error);
                return new Date().toISOString().split('T')[0];
            }
        }

        function addDays(date, days) {
            try {
                const result = new Date(date);
                result.setDate(result.getDate() + days);
                return result;
            } catch (error) {
                console.error('Error adding days:', error);
                return new Date();
            }
        }

        function getLast7Days() {
            try {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    days.push(getDateKey(addDays(new Date(), -i)));
                }
                return days;
            } catch (error) {
                console.error('Error getting last 7 days:', error);
                return [];
            }
        }

        // Data Persistence
        function saveData() {
            try {
                window.appDataStore = JSON.stringify(appData);
                showSaveIndicator();
            } catch (error) {
                console.error('Save error:', error);
            }
        }

        function loadData() {
            try {
                const saved = window.appDataStore;
                if (saved) {
                    const parsed = JSON.parse(saved);
                    Object.assign(appData, {
                        ...appData,
                        ...parsed,
                        habits: { ...appData.habits, ...parsed.habits }
                    });
                    
                    // Ensure arrays are properly handled
                    if (!Array.isArray(appData.journalTags)) {
                        appData.journalTags = [];
                    }
                    
                    // Initialize lastResetDate if not present
                    if (!appData.lastResetDate) {
                        appData.lastResetDate = getDateKey(new Date());
                    }
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        function showSaveIndicator() {
            try {
                const indicator = document.getElementById('saveIndicator');
                indicator.style.opacity = '1';
                setTimeout(() => {
                    indicator.style.opacity = '0.7';
                }, 2000);
            } catch (error) {
                console.error('Error showing save indicator:', error);
            }
        }

        // Export/Import
        function exportData() {
            try {
                const dataStr = JSON.stringify(appData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `elite-life-mastery-${getDateKey(new Date())}.json`;
                link.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Export error:', error);
            }
        }

        function importData(event) {
            try {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (confirm('This will replace your current data. Are you sure?')) {
                                Object.assign(appData, importedData);
                                saveData();
                                initializeApp();
                                alert('Data imported successfully!');
                            }
                        } catch (error) {
                            alert('Error importing data. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            } catch (error) {
                console.error('Import error:', error);
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', initializeApp);

        window.onclick = function(event) {
            const modal = document.getElementById('practiceModal');
            const journalModal = document.getElementById('journalHistoryModal');
            const editModal = document.getElementById('editJournalModal');
            
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === journalModal) {
                closeJournalHistoryModal();
            }
            if (event.target === editModal) {
                closeEditJournalModal();
            }
        };

        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && document.getElementById('practiceModal').style.display === 'block') {
                addNewPractice();
            }
        });
    </script>
</body>
</html>